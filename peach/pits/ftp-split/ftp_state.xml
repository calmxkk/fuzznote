<?xml version="1.0" encoding="utf-8"?>
<Peach xmlns="http://peachfuzzer.com/2012/Peach" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://peachfuzzer.com/2012/Peach ../peach.xsd">

    <Include ns="ftp" src="file:./ftp_data.xml" />

    <!-- Commands you can execute before being authenticated. -->

    <!-- USER: Try to authenticate with the malformed USER command. -->
    <StateModel name="StateWithoutAuth" initialState="Initial">
        <State name="Initial">
            <Action type="connect" />
            <!-- Read welcome message. -->
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <!-- Send USER command to ftp server. -->
            <Action type="output">
                <DataModel ref="ftp:DataUSER" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataPASS" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataPORT" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <!-- ACCT: The ACCT command is sometimes available without being authenticated.  -->
            <Action type="output">
                <DataModel ref="ftp:DataACCT" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <!-- HELP: The HELP command is sometimes available without being authenticated. -->
            <Action type="output">
                <DataModel ref="ftp:DataHELP" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataADAT" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataPBSZ" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataAUTH" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <!-- QUIT: The QUIT command is sometimes available without being authenticated. -->
            <Action type="output">
                <DataModel ref="ftp:DDataQUIT" />
            </Action>
            <Action type="close" />
        </State>
    </StateModel>

    <!-- Commands where you need to be authenticated. -->
    <StateModel name="StatAuth" initialState="Initial">
        <State name="Initial">
            <Action type="connect" />
            <!-- Read welcome message. -->
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <!-- Send USER command to ftp server. -->
            <Action type="output">
                <DataModel ref="ftp:DDataUSER" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <!-- Send PASS command to ftp server. -->
            <Action type="output">
                <DataModel ref="ftp:DDataPASS" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <!-- Send HELP command. -->
            <Action type="output">
                <DataModel ref="ftp:DataHELP" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataACCT" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataCWD" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataCDUP" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataSMNT" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataREIN" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataTYPE1" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataTYPE2" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataTYPE3" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataTYPE4" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataSTRU" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataPORT" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataPASV" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataMODE" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataRETR" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataSTOR" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataSTOU" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataAPPE" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataALLO" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataREST" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataRNFR" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataRNTO" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataABOR" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataDELE" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataRMD" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataMKD" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataPWD" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataLIST" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataNLST" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataSITE" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataSYST" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataSTAT" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataNOOP" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataHOST" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataPBSZ" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataCCC" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataMIC" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataCONF" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataENC" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataALGS" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataEPRT" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataEPSV" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataFEAT" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataOPTS" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataLANG" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataLPRT" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataLPSV" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataMDTM" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataMLST" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataMLSD" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataSIZE" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataXRMD" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataXMKD" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataXPWD" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataXCWD" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataXCUP" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>


            <!-- Send QUIT command. -->
            <Action type="output">
                <DataModel ref="ftp:DDataQUIT" />
            </Action>
            <Action type="close" />
        </State>
    </StateModel>

    <!-- Special PASV commands. -->
    <StateModel name="StatePASV" initialState="Initial">
        <State name="Initial">
            <Action type="connect" />
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>
            <Action type="output">
                <DataModel ref="ftp:DDataUSER" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>
            <Action type="output">
                <DataModel ref="ftp:DDataPASS" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <!-- PASV -->
            <Action type="output">
                <DataModel ref="ftp:DDataPASS" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <!-- APPE -->
            <Action type="output">
                <DataModel ref="ftp:DataAPPE" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <!-- STOR -->
            <Action type="output">
                <DataModel ref="ftp:DataSTOR" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <!-- RETR -->
            <Action type="output">
                <DataModel ref="ftp:DataRETR" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <!-- STOU -->
            <Action type="output">
                <DataModel ref="ftp:DataSTOU" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <!-- LIST -->
            <Action type="output">
                <DataModel ref="ftp:DataLIST" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <!-- NLST -->
            <Action type="output">
                <DataModel ref="ftp:DataNLST" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DDataQUIT" />
            </Action>
            <Action type="close" />
        </State>
    </StateModel>

    <!-- Special PORT commands. -->
    <StateModel name="StatePORT" initialState="Initial">
        <State name="Initial">
            <Action type="connect" />
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>
            <Action type="output">
                <DataModel ref="ftp:DDataUSER" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>
            <Action type="output">
                <DataModel ref="ftp:DDataPASS" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <!-- PORT -->
            <Action type="output">
                <DataModel ref="ftp:DDataPORT" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <!-- APPE -->
            <Action type="output">
                <DataModel ref="ftp:DataAPPE" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <!-- STOR -->
            <Action type="output">
                <DataModel ref="ftp:DataSTOR" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <!-- RETR -->
            <Action type="output">
                <DataModel ref="ftp:DataRETR" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <!-- STOU -->
            <Action type="output">
                <DataModel ref="ftp:DataSTOU" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <!-- LIST -->
            <Action type="output">
                <DataModel ref="ftp:DataLIST" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <!-- NLST -->
            <Action type="output">
                <DataModel ref="ftp:DataNLST" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>


            <Action type="output">
                <DataModel ref="ftp:DDataQUIT" />
            </Action>
            <Action type="close" />
        </State>
    </StateModel>


    <!-- Special REST commands. -->
    <StateModel name="StateRESTAPPE" initialState="Initial">
        <State name="Initial">
            <Action type="connect" />
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>
            <Action type="output">
                <DataModel ref="ftp:DDataUSER" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>
            <Action type="output">
                <DataModel ref="ftp:DDataPASS" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>
            <Action type="output">
                <DataModel ref="ftp:DDataREST" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>
            <Action type="output">
                <DataModel ref="ftp:DataAPPE" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataSTOR" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="output">
                <DataModel ref="ftp:DataRETR" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>

            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>
            <Action type="output">
                <DataModel ref="ftp:DDataQUIT" />
            </Action>
            <Action type="close" />
        </State>
    </StateModel>

    <!--                       -->
    <!-- Special RNFR command. -->
    <!--                       -->
    <StateModel name="StateMkdRnfr" initialState="Initial">
        <State name="Initial">
            <Action type="connect" />
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>
            <Action type="output">
                <DataModel ref="ftp:DDataUSER" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>
            <Action type="output">
                <DataModel ref="ftp:DDataPASS" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>
            <Action type="output">
                <DataModel ref="ftp:DDataMKD" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>
            <Action type="output">
                <DataModel ref="ftp:DDataRNFR" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>
            <Action type="output">
                <DataModel ref="ftp:DataRNTO" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>
            <Action type="output">
                <DataModel ref="ftp:DDataQUIT" />
            </Action>
            <Action type="close" />
        </State>
    </StateModel>


    <StateModel name="AStateAUTHADAT" initialState="Initial">
        <State name="Initial">
            <Action type="connect" />
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>
            <Action type="output">
                <DataModel ref="ftp:DataAUTH" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>
            <Action type="output">
                <DataModel ref="ftp:DataADAT" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>
            <Action type="output">
                <DataModel ref="ftp:DDataUSER" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>
            <Action type="output">
                <DataModel ref="ftp:DDataPASS" />
            </Action>
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>
            <Action type="output">
                <DataModel ref="ftp:DDataQUIT" />
            </Action>
            <Action type="close" />
        </State>
    </StateModel>


    <!-- 
    Check for the supported commands on the FTP server.
  -->
    <StateModel name="CheckFTPCommands" initialState="Initial">
        <State name="Initial">
            <Action type="connect" />
            <Action type="input">
                <DataModel ref="ftp:DataResponse" />
            </Action>
            <Action type="output">
                <DataModel ref="ftp:DDataUSER" />
            </Action>
            <Action type="close" />
        </State>
    </StateModel>


</Peach>